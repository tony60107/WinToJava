
  SELECT IMP_GOODS_STORAGE.GCI_DATE,   
         IMP_GOODS_STORAGE.AIRLINE_ID,   
         IMP_GOODS_STORAGE.FLT_DATE,   
         IMP_GOODS_STORAGE.FLT_NO,     
         IMP_GOODS_STORAGE.FLT_TIME,  
			IMP_GOODS_STORAGE.DATA_CLASS,
         IMP_GOODS_STORAGE.CHARGE_TYPE,  
			IMP_GOODS_STORAGE.AGENT_CODE,
			IMP_GOODS_STORAGE.ACT_PCS,  
         IMP_GOODS_STORAGE.PCS,   
         IMP_GOODS_STORAGE.WET,   
         IMP_GOODS_STORAGE.VOL_WET
         into :ls_gci_date,
                  :ls_airline_id,
                  :ls_flt_date,
                  :ls_flt_no,
                  :li_flt_time,
         			:ls_data_class,
                  :ls_charge_type,
         			:ls_agent_code,
         			:ll_act_pcs,
                  :ll_pcs,
                  :ld_wet,
                  :ld_vol_wet
    FROM (	 
  SELECT IMP_GOODS_STORAGE.GCI_DATE,   
         IMP_GOODS_STORAGE.AIRLINE_ID,   
         IMP_GOODS_STORAGE.FLT_DATE,   
         IMP_GOODS_STORAGE.FLT_NO,     
         IMP_GOODS_STORAGE.FLT_TIME,  
			IMP_SPECIAL.DATA_CLASS,
         DECODE(IMP_SPECIAL.DATA_CLASS,'BD','ML','BC','ML',IMP_WORK_AREA.CHARGE_TYPE) CHARGE_TYPE,  
			IMP_SPECIAL.AGENT_CODE,
			IMP_GOODS_IN.ACT_PCS,  
         sum(nvl(IMP_GOODS_STORAGE.PCS,0)) PCS,   
         sum(nvl(IMP_GOODS_STORAGE.WET,0)) WET,   
         sum(nvl(IMP_GOODS_STORAGE.VOL_WET,0)) VOL_WET  
    FROM IMP_GOODS_STORAGE,
			IMP_GOODS_IN,
			IMP_WORK_AREA,
			(
			  SELECT IMP_SPECIAL.CARGO_LOCATION,
			         IMP_SPECIAL.MWB_NO,
			         IMP_SPECIAL.MWB_NO2,
			         IMP_SPECIAL.HWB_NO,
			         IMP_SPECIAL.GCI_DATE,
			         IMP_SPECIAL.AIRLINE_ID,
			         IMP_SPECIAL.FLT_NO,
			         IMP_SPECIAL.FLT_DATE,
						IMP_SPECIAL.DATA_TYPE,
						IMP_SPECIAL.DATA_CLASS,
						MAX(IMP_SPECIAL.AGENT_CODE) AGENT_CODE
				 FROM IMP_SPECIAL
				WHERE IMP_SPECIAL.CARGO_LOCATION = :gs_uinfo.u_cargo_loca
			     AND IMP_SPECIAL.MWB_NO         = :ls_mwb_no
			     AND IMP_SPECIAL.MWB_NO2        = :ls_mwb_no2
			     AND IMP_SPECIAL.HWB_NO         = :ls_hwb_no
				  AND IMP_SPECIAL.DATA_TYPE      = 'T' 
	           AND IMP_SPECIAL.DATA_CLASS in ('B','BD','BC','BE')
			GROUP BY IMP_SPECIAL.CARGO_LOCATION,
			         IMP_SPECIAL.MWB_NO,
			         IMP_SPECIAL.MWB_NO2,
			         IMP_SPECIAL.HWB_NO,
			         IMP_SPECIAL.GCI_DATE,
			         IMP_SPECIAL.AIRLINE_ID,
			         IMP_SPECIAL.FLT_NO,
			         IMP_SPECIAL.FLT_DATE,
						IMP_SPECIAL.DATA_TYPE,
						IMP_SPECIAL.DATA_CLASS						
			) IMP_SPECIAL
   WHERE IMP_GOODS_STORAGE.cargo_location =:gs_uinfo.u_cargo_loca
	  and IMP_GOODS_STORAGE.mwb_no    =:ls_mwb_no
	  and IMP_GOODS_STORAGE.mwb_no2   =:ls_mwb_no2
	  and IMP_GOODS_STORAGE.hwb_no    =:ls_hwb_no
	  and IMP_GOODS_STORAGE.DATA_TYPE = 'T'
	  and IMP_GOODS_STORAGE.PCS       > 0
	  and IMP_GOODS_STORAGE.CARGO_LOCATION = IMP_GOODS_IN.CARGO_LOCATION
	  and IMP_GOODS_STORAGE.MWB_NO         = IMP_GOODS_IN.MWB_NO
	  and IMP_GOODS_STORAGE.MWB_NO2        = IMP_GOODS_IN.MWB_NO2
	  and IMP_GOODS_STORAGE.HWB_NO         = IMP_GOODS_IN.HWB_NO
	  and IMP_GOODS_STORAGE.GCI_DATE       = IMP_GOODS_IN.GCI_DATE
	  and IMP_GOODS_STORAGE.AIRLINE_ID     = IMP_GOODS_IN.AIRLINE_ID
	  and IMP_GOODS_STORAGE.FLT_NO         = IMP_GOODS_IN.FLT_NO
	  and IMP_GOODS_STORAGE.FLT_DATE       = IMP_GOODS_IN.FLT_DATE
	  and IMP_GOODS_STORAGE.DATA_TYPE      = IMP_GOODS_IN.DATA_TYPE	  
	  and IMP_GOODS_STORAGE.CARGO_LOCATION = IMP_SPECIAL.CARGO_LOCATION
	  and IMP_GOODS_STORAGE.MWB_NO         = IMP_SPECIAL.MWB_NO
	  and IMP_GOODS_STORAGE.MWB_NO2        = IMP_SPECIAL.MWB_NO2
	  and IMP_GOODS_STORAGE.HWB_NO         = IMP_SPECIAL.HWB_NO
	  and IMP_GOODS_STORAGE.GCI_DATE       = IMP_SPECIAL.GCI_DATE
	  and IMP_GOODS_STORAGE.AIRLINE_ID     = IMP_SPECIAL.AIRLINE_ID
	  and IMP_GOODS_STORAGE.FLT_NO         = IMP_SPECIAL.FLT_NO
	  and IMP_GOODS_STORAGE.FLT_DATE       = IMP_SPECIAL.FLT_DATE
	  and IMP_GOODS_STORAGE.DATA_TYPE      = IMP_SPECIAL.DATA_TYPE	 
	  and IMP_GOODS_IN.ACT_PCS > 0  
     and IMP_GOODS_IN.ACT_WET > 0 
	  and IMP_GOODS_STORAGE.CARGO_LOCATION = IMP_WORK_AREA.CARGO_LOCATION (+)
     and IMP_GOODS_STORAGE.DATA_TYPE      = IMP_WORK_AREA.DATA_TYPE (+)
     and IMP_GOODS_STORAGE.LOCATION       = IMP_WORK_AREA.LOCATION (+) 
GROUP BY IMP_GOODS_STORAGE.GCI_DATE,   
         IMP_GOODS_STORAGE.AIRLINE_ID,   
         IMP_GOODS_STORAGE.FLT_DATE,   
         IMP_GOODS_STORAGE.FLT_NO,   
         IMP_GOODS_STORAGE.FLT_TIME,  
			IMP_SPECIAL.DATA_CLASS, 
         DECODE(IMP_SPECIAL.DATA_CLASS,'BD','ML','BC','ML',IMP_WORK_AREA.CHARGE_TYPE),
			IMP_SPECIAL.AGENT_CODE,
			IMP_GOODS_IN.ACT_PCS
		 ) IMP_GOODS_STORAGE
;
			
